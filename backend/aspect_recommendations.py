import logging
from typing import Dict, List, Any
import random

logger = logging.getLogger(__name__)


class AspectRecommendationEngine:
    """
    –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –æ–±–ª–∞—Å—Ç—è–º–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
    """

    def __init__(self):
        # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
        self.action_areas = {
            'conjunction': [
                "–Ω–∞—á–∞–ª–æ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤", "—Ä–µ—à–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è", "–∑–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤",
                "–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω—ã", "–ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã", "—Å—Ç–∞—Ä—Ç –≤–∞–∂–Ω—ã—Ö –¥–µ–ª"
            ],
            'opposition': [
                "–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –∏ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã", "–ø–æ–∏—Å–∫ –±–∞–ª–∞–Ω—Å–∞", "—É—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤",
                "—Ä–∞–±–æ—Ç–∞ –≤ –∫–æ–º–∞–Ω–¥–µ", "—É—á–µ—Ç —Ä–∞–∑–Ω—ã—Ö –º–Ω–µ–Ω–∏–π", "–¥–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è"
            ],
            'square': [
                "–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π", "—Ä–µ—à–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á", "–±–æ—Ä—å–±–∞ —Å —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏",
                "—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º", "–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –∫—Ä–∏–∑–∏—Å–æ–≤", "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫"
            ],
            'trine': [
                "—Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã", "—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ", "—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–¥–µ–π",
                "–≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ", "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π", "–æ–±—É—á–µ–Ω–∏–µ –∏ —Ä–æ—Å—Ç"
            ],
            'sextile': [
                "—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π", "–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç", "–ø–æ–∏—Å–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π",
                "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ", "—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫—Ä—É–≥–æ–∑–æ—Ä–∞", "–Ω–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞"
            ]
        }

        # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø–ª–∞–Ω–µ—Ç
        self.planet_actions = {
            'Sun': [
                "–ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä—Å—Ç–≤–∞", "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏", "—Ç–≤–æ—Ä—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è",
                "–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ç–∞–ª–∞–Ω—Ç–æ–≤", "—Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –∏–º–∏–¥–∂–µ–º", "—Ä–∞–∑–≤–∏—Ç–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç–∏"
            ],
            'Moon': [
                "–∑–∞–±–æ—Ç–∞ –æ —ç–º–æ—Ü–∏—è—Ö", "—Å–æ–∑–¥–∞–Ω–∏–µ —É—é—Ç–∞", "—Ä–∞–±–æ—Ç–∞ —Å –∏–Ω—Ç—É–∏—Ü–∏–µ–π",
                "—Å–µ–º–µ–π–Ω—ã–µ –¥–µ–ª–∞", "–æ—Ç–¥—ã—Ö –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ", "–∫—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã"
            ],
            'Mercury': [
                "–æ–±—É—á–µ–Ω–∏–µ –∏ —É—á–µ–±–∞", "–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã", "–ø–∏—Å—å–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞",
                "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "–∞–Ω–∞–ª–∏–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏", "–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è"
            ],
            'Venus': [
                "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π", "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ", "—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
                "—Å–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–∞—Å–æ—Ç—ã", "—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", "–∏—Å–∫—É—Å—Å—Ç–≤–æ"
            ],
            'Mars': [
                "—Å–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", "–∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è", "—Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á",
                "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞", "–∑–∞—â–∏—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤", "—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏"
            ],
            'Jupiter': [
                "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π", "–æ–±—É—á–µ–Ω–∏–µ", "—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞",
                "—Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è", "–ø–æ–∏—Å–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π", "–ª–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç"
            ],
            'Saturn': [
                "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è", "—Ä–∞–±–æ—Ç–∞ —Å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏",
                "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã", "–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤", "—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"
            ],
            'Uranus': [
                "–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏", "—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã", "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã",
                "–Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è", "–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤", "—Å–≤–æ–±–æ–¥–Ω–æ–µ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ"
            ],
            'Neptune': [
                "–º–µ–¥–∏—Ç–∞—Ü–∏—è", "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ", "—Ä–∞–±–æ—Ç–∞ —Å –∏–Ω—Ç—É–∏—Ü–∏–µ–π",
                "–ø–æ–º–æ—â—å –¥—Ä—É–≥–∏–º", "–∏—Å–∫—É—Å—Å—Ç–≤–æ", "–¥—É—Ö–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏"
            ],
            'Pluto': [
                "—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è", "–∏–∑–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ", "–≥–ª—É–±–∏–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑",
                "—Ä–∞–±–æ—Ç–∞ —Å –∫—Ä–∏–∑–∏—Å–∞–º–∏", "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã", "—Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
            ]
        }

        # –£–ª—É—á—à–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        self.aspect_templates = {
            'conjunction': {
                'positive': [
                    "–≠–Ω–µ—Ä–≥–∏—è {transit} –∏ {natal} –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è - –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è {action} –≤ –æ–±–ª–∞—Å—Ç–∏ {area}",
                    "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ {transit} —Å {natal} –¥–∞–µ—Ç –º–æ—â–Ω—ã–π –∏–º–ø—É–ª—å—Å –¥–ª—è {action}, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ {area}",
                    "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é {transit} –∏ {natal} –¥–ª—è {action}, –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ {area}"
                ],
                'challenge': [
                    "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ {transit} –∏ {natal} —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ - –±—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –ø—Ä–∏ {action} –≤ {area}",
                    "–≠–Ω–µ—Ä–≥–∏—è –∞—Å–ø–µ–∫—Ç–∞ –æ—á–µ–Ω—å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è - —Å—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ {action} –≤ {area}",
                    "–ú–æ—â–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ –≤ {area}, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ {action}"
                ]
            },
            'opposition': {
                'positive': [
                    "–û–ø–ø–æ–∑–∏—Ü–∏—è {transit} –∏ {natal} –ø–æ–º–æ–≥–∞–µ—Ç –≤ {action} - –∏—â–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤ {area}",
                    "–ò–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è {action} —á–µ—Ä–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã –≤ {area}",
                    "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–π –¥–ª—è {action} –≤ {area}"
                ],
                'challenge': [
                    "–û–ø–ø–æ–∑–∏—Ü–∏—è {transit}-{natal} —Ç—Ä–µ–±—É–µ—Ç –≥–∏–±–∫–æ—Å—Ç–∏ –≤ {area}, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ {action}",
                    "–í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤ {area} - –∏—â–∏—Ç–µ –∑–æ–ª–æ—Ç—É—é —Å–µ—Ä–µ–¥–∏–Ω—É –¥–ª—è {action}",
                    "–ò–∑–±–µ–≥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ {area}, –ª—É—á—à–µ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ {action}"
                ]
            },
            'square': {
                'positive': [
                    "–ö–≤–∞–¥—Ä–∞—Ç {transit} –∏ {natal} –¥–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é –¥–ª—è {action} –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö {area}",
                    "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∞—Å–ø–µ–∫—Ç–∞ –¥–ª—è {action} –≤ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö {area}",
                    "–≠—Ç–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è {action} –≤ —Ç—Ä—É–¥–Ω—ã—Ö {area}"
                ],
                'challenge': [
                    "–ö–≤–∞–¥—Ä–∞—Ç—É—Ä–∞ {transit}-{natal} —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ {action} –≤ {area}",
                    "–í–æ–∑–º–æ–∂–Ω—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ {area} - –∏–º–µ–π—Ç–µ –∑–∞–ø–∞—Å–Ω–æ–π –ø–ª–∞–Ω –¥–ª—è {action}",
                    "–ò–∑–±–µ–≥–∞–π—Ç–µ –∫–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏–∏ –≤ {area}, —Ä–µ—à–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ {action}"
                ]
            },
            'trine': {
                'positive': [
                    "–¢—Ä–∏–Ω {transit} –∏ {natal} –ø—Ä–∏–Ω–æ—Å–∏—Ç –≥–∞—Ä–º–æ–Ω–∏—é –¥–ª—è {action} –≤ {area}",
                    "–ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è {action} —á–µ—Ä–µ–∑ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ –≤ {area}",
                    "–≠–Ω–µ—Ä–≥–∏—è —Ç–µ—á–µ—Ç –ª–µ–≥–∫–æ - –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è {action} –≤ {area}"
                ],
                'challenge': [
                    "–ü—Ä–∏ –ª–µ–≥–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏ —Ç—Ä–∏–Ω–∞ –≤–∞–∂–Ω–æ –Ω–µ —É–ø—É—Å–∫–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è {action} –≤ {area}",
                    "–ù–µ —Ä–∞—Å—Å–ª–∞–±–ª—è–π—Ç–µ—Å—å —Å–ª–∏—à–∫–æ–º - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è {action} –≤ {area}",
                    "–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ {area}, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è {action}"
                ]
            },
            'sextile': {
                'positive': [
                    "–°–µ–∫—Å—Ç–∏–ª—å {transit} –∏ {natal} –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –¥–ª—è {action} –≤ {area}",
                    "–ò–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è {action} —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏ –≤ {area}",
                    "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è {action} –∏ —Ä–æ—Å—Ç–∞ –≤ {area}"
                ],
                'challenge': [
                    "–ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –≤ {area} –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è {action}",
                    "–ù–µ —Ä–∞—Å–ø—ã–ª—è–π—Ç–µ—Å—å –≤ {area} - –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∞–º—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è {action}",
                    "–£–¥–µ–ª–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é {action} –≤ {area}"
                ]
            }
        }

        # –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–ª–∞–Ω–µ—Ç
        self.planet_names_ru = {
            'Sun': '–°–æ–ª–Ω—Ü–∞', 'Moon': '–õ—É–Ω—ã', 'Mercury': '–ú–µ—Ä–∫—É—Ä–∏—è',
            'Venus': '–í–µ–Ω–µ—Ä—ã', 'Mars': '–ú–∞—Ä—Å–∞', 'Jupiter': '–Æ–ø–∏—Ç–µ—Ä–∞',
            'Saturn': '–°–∞—Ç—É—Ä–Ω–∞', 'Uranus': '–£—Ä–∞–Ω–∞', 'Neptune': '–ù–µ–ø—Ç—É–Ω–∞',
            'Pluto': '–ü–ª—É—Ç–æ–Ω–∞', 'North_Node': '–°–µ–≤–µ—Ä–Ω–æ–≥–æ –£–∑–ª–∞',
            'Ascendant': '–ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç–∞', 'Midheaven': '–°–µ—Ä–µ–¥–∏–Ω—ã –ù–µ–±–∞'
        }

    def generate_aspect_recommendations(self, aspects_data: List[Dict]) -> List[str]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å –æ–±–ª–∞—Å—Ç—è–º–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
        """
        recommendations = []

        try:
            # –°–æ—Ä—Ç–∏—Ä—É–µ–º –∞—Å–ø–µ–∫—Ç—ã –ø–æ —Å–∏–ª–µ (—Å–∞–º—ã–µ —Å–∏–ª—å–Ω—ã–µ –ø–µ—Ä–≤—ã–µ)
            strong_aspects = [a for a in aspects_data if a.get('strength', 0) > 0.7]
            sorted_aspects = sorted(strong_aspects, key=lambda x: x.get('strength', 0), reverse=True)

            # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-3 —Å–∞–º—ã—Ö —Å–∏–ª—å–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–∞
            for aspect in sorted_aspects[:3]:
                rec = self._generate_specific_aspect_recommendation(aspect)
                if rec:
                    recommendations.append(rec)

            # –ï—Å–ª–∏ —Å–∏–ª—å–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –º–∞–ª–æ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            if len(recommendations) < 2:
                general_recs = self._get_general_recommendations(aspects_data)
                recommendations.extend(general_recs[:2])

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∞—Å–ø–µ–∫—Ç–æ–≤: {e}")
            recommendations = [
                "–°–µ–≥–æ–¥–Ω—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω - —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–ª–∞–Ω–æ–≤—ã—Ö –¥–µ–ª –∏ —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á"]

        return recommendations

    def _generate_specific_aspect_recommendation(self, aspect: Dict) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å –æ–±–ª–∞—Å—Ç—è–º–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è"""
        try:
            transit_planet = aspect.get('transit_planet', '')
            natal_planet = aspect.get('natal_planet', '')
            aspect_type = aspect.get('aspect', '')
            strength = aspect.get('strength', 0)

            if not all([transit_planet, natal_planet, aspect_type]):
                return None

            # –ü–æ–ª—É—á–∞–µ–º —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–ª–∞–Ω–µ—Ç
            transit_ru = self.planet_names_ru.get(transit_planet, transit_planet)
            natal_ru = self.planet_names_ru.get(natal_planet, natal_planet)

            # –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è –∏–ª–∏ –≤—ã–∑–æ–≤)
            rec_type = 'positive' if strength > 0.8 else 'challenge'

            # –í—ã–±–∏—Ä–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å –∏ –¥–µ–π—Å—Ç–≤–∏–µ
            area = random.choice(self.action_areas.get(aspect_type, ["—Ä–∞–∑–Ω—ã—Ö —Å—Ñ–µ—Ä–∞—Ö –∂–∏–∑–Ω–∏"]))
            action = random.choice(self.planet_actions.get(transit_planet, ["–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π"]))

            # –ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∞—Å–ø–µ–∫—Ç–∞
            templates = self.aspect_templates.get(aspect_type, {}).get(rec_type, [])

            if templates:
                template = random.choice(templates)
                recommendation = template.format(
                    transit=transit_ru,
                    natal=natal_ru,
                    action=action,
                    area=area
                )

                # –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∞—Å–ø–µ–∫—Ç–∞
                emoji_map = {
                    'conjunction': '‚ö°', 'opposition': '‚öñÔ∏è',
                    'square': 'üéØ', 'trine': 'üåü', 'sextile': 'üí´'
                }
                emoji = emoji_map.get(aspect_type, '‚ú®')

                return f"{emoji} {recommendation}"

        except Exception as e:
            logger.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∞—Å–ø–µ–∫—Ç–∞: {e}")

        return None

    def _get_general_recommendations(self, aspects_data: List[Dict]) -> List[str]:
        """–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏"""
        general_recs = []

        try:
            total_aspects = len(aspects_data)
            strong_aspects = len([a for a in aspects_data if a.get('strength', 0) > 0.7])

            # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞—Å–ø–µ–∫—Ç–æ–≤
            if total_aspects == 0:
                actions = ["—á—Ç–µ–Ω–∏–∏ –∫–Ω–∏–≥", "—É–±–æ—Ä–∫–µ –¥–æ–º–∞", "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–µ–¥–µ–ª–∏", "–æ—Ç–¥—ã—Ö–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏"]
                general_recs.append(
                    f"üåô –°–µ–≥–æ–¥–Ω—è —Å–ø–æ–∫–æ–π–Ω—ã–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω - —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è {random.choice(actions)}")
            elif total_aspects <= 3:
                actions = ["—Ä–∞–∑–º–µ—Ä–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ", "–∞–Ω–∞–ª–∏–∑—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏", "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", "–æ–±—É—á–µ–Ω–∏—é"]
                general_recs.append(f"‚öñÔ∏è –ù–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Å–ø–µ–∫—Ç–æ–≤ - –¥–µ–Ω—å –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è {random.choice(actions)}")
            elif total_aspects > 8:
                actions = ["—Ä–µ—à–µ–Ω–∏—é —Å—Ä–æ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤", "–º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏", "–ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∞–º", "–ø—Ä–∏–Ω—è—Ç–∏—é —Ä–µ—à–µ–Ω–∏–π"]
                general_recs.append(f"üéØ –ú–Ω–æ–≥–æ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≤–ª–∏—è–Ω–∏–π - –±—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã –∫ {random.choice(actions)}")

            # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–∏–ª–µ –∞—Å–ø–µ–∫—Ç–æ–≤
            if strong_aspects >= 3:
                actions = ["–≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π", "—Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è", "—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤", "–ø–µ—Ä–µ–º–µ–Ω"]
                general_recs.append(f"üí• –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ - –≤–∞–∂–Ω—ã–π –¥–µ–Ω—å –¥–ª—è {random.choice(actions)}")
            elif strong_aspects == 0 and total_aspects > 0:
                actions = ["–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞", "–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π", "—Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–æ–≤", "–æ–±—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–º—É"]
                general_recs.append(f"üåä –ê—Å–ø–µ–∫—Ç—ã —Å–ª–∞–±—ã–µ - —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è {random.choice(actions)}")

        except Exception as e:
            logger.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±—â–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: {e}")

        return general_recs


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–≤–∏–∂–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
aspect_recommendations = AspectRecommendationEngine()