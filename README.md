Документация проекта personal_assistant (текущее состояние)

***

## Назначение проекта
Проект personal_assistant представляет собой персонального ассистента в виде Telegram-бота, который предоставляет пользователю персонализированные рекомендации на основе астрологических, нумерологических и биоритмических расчетов. Цель — помочь пользователю в самореализации и развитии, давая ежедневные советы, основанные на данных натальной карты, психоматрицы и биоритмов.

***

## Основные функции
- Сбор и валидация пользовательских данных (дата, время и место рождения, пол, профессия, город проживания)
- Формирование натальной карты пользователя
- Вычисление психоматрицы на основе даты рождения
- Расчет биоритмов (физический, эмоциональный, интеллектуальный и интуитивный циклы)
- Генерация персонализированных рекомендаций на выбранные даты (сегодня, завтра, произвольная дата)
- Вывод рекомендаций пользователю через Telegram-бота в удобном формате
- Подготовка и форматирование данных для AI-модели для дальнейшей оптимизации рекомендаций

***

## Архитектура и структура проекта

### Бот (директория `bot/`)
- `config.py` — конфигурация токена Telegram-бота
- `handlers.py` — обработчики команд и сообщений, реализация диалогов с пользователем
- `main.py` — запуск и настройка бота, подключение роутеров
- `__init__.py` — инициализация модуля bot

Ключевые компоненты:
- FSM (Finite State Machine) для поэтапного сбора данных пользователя с возможностью выбора пола и даты
- Меню с клавиатурами для управления взаимодействием
- Обработка ошибок и информирование пользователя о состоянии

### Бэкенд (директория `backend/`)
- `assistant.py` — главный класс PersonalAssistant, управляющий сбором данных, расчетами и выдачей результатов
- `biorhythm_calculator.py` — модуль математических расчетов биоритмов
- `biorhythm_services.py` — сохранение и загрузка биоритмов из базы
- `matrix_services.py` — расчет и хранение психоматрицы
- `chart_services.py` — генерация натальной карты
- `database.py`, `db_connection.py` — управление подключением к СУБД PostgreSQL
- `user_services.py` — CRUD операции с профилем пользователя в базе
- `prediction_services.py` — генерация, форматирование и хранение предсказаний
- `moon.py` — расчет лунных фаз (в перспективе)
- `psyho_matrix.py` — психоматрица (нумерология)
- `natal_chart.py` — астрологические расчеты

Общие особенности:
- Асинхронная работа с базой данных с использованием транзакций для консистентности
- Логирование и обработка исключений по всей цепочке вызовов
- Разделение данных на пользовательские и модельные (для AI)

### База данных (PostgreSQL)
Таблицы:
- users — профиль пользователя с расширенным набором полей, включая пол (gender)
- user_natal_charts — натальные данные в формате JSONB
- psyho_matrix — данные психоматрицы JSONB
- natal_predictions — предсказания, их данные и вспомогательная информация JSONB
- biorhythms — данные биоритмов JSONB с датами вычислений

***

## Взаимодействие компонентов

1. Пользователь через Telegram-бота вводит/обновляет свои персональные данные (сбор данных через FSM).
2. Бот вызывает PersonalAssistant.collect_user_data, который сохраняет данные в базу и вызывает расчеты натальной карты, психоматрицы, биоритмов.
3. Пользователь запрашивает рекомендации на определённую дату через меню, бот вызывает PersonalAssistant.get_recommendations.
4. Внутри происходит генерация предсказаний, форматирование для пользователя и подготовка данных для AI модели.
5. Результаты отправляются пользователю ботом.

***

## Технические требования

- Python 3.10+
- PostgreSQL 16 с созданными таблицами (для схемы используется JSONB для гибкости)
- Aiogram для Telegram-бота
- Асинхронный фреймворк asyncio
- Docker-compose для запуска PostgreSQL и сервисов

***

## Использование

- Запустить базу данных PostgreSQL через docker-compose или локально с заданной конфигурацией
- Установить зависимости Python из requirements.txt (aiogram, asyncpg, и др.)
- Запустить бота скриптом bot/main.py
- В Telegram найти бота по токену, начать диалог и пройти процесс регистрации данных
- Запрашивать рекомендации через меню

***

## Возможности дальнейшего развития

- Интеграция AI модели для оптимизации и персонализации рекомендаций на основе накопленных данных
- Добавление расчетов с учетом пола пользователя для более точных рекомендаций
- Усовершенствование механизма валидации и проверок данных
- Расширение функций, включая лунные фазы, дополнительные транзиты и аспекты
- Реализация кэширования и ускорения вычислений

***

Эта документация отражает текущее состояние проекта и его ключевые аспекты, обеспечивая понимание архитектуры, функционала и процесса использования. 



